# MySQL索引原理

InnoDB支持常见的索引有：

- B+树索引：
- 全文索引
- 哈希索引： 自适应哈希索引的构建，根据数据库的使用情况为热点数据生成一个自适应hash索引，提高检索性能。

## 一. B+树索引
### B+ 树
B+树是为了磁盘或其他直接存取辅助设备设计的一种平衡查找树。

### B+树索引
B+树索引具有高扇出性，因此在数据库中B+树的高度一般是2-4层，因此最多执行2-4次IO操作。

B+树索引分为**聚类索引(cluseted index)**和**辅助索引(secondary index)**

#### 聚集索引
表中的数据按照主键顺序存放，**聚类索引**就是按照每张表的主键构造一颗B+树，同时叶子节点中存放的即为整张表的行**记录数据**，也将聚类索引的叶子节点称为**数据页**。聚集索引的这个特性决定了索引组织表中数据也是索引的一部分。

和B+树数据结构一样，每个数据页都通过一个双向链表来进行链接。

B+树索引是按照顺序物理地存放数据。聚集索引的好处是它对主键的**排序查询和范围查找**速度非常快。


优点:

- 把相关数据保存到一起。按顺序存储，当实现电子邮箱的时候，安装userId进行聚集，可以将同一个用户的邮箱放在一起。
- 数据访问快。

不足：

- 插入的速度严重依赖于插入顺序。如果不是按主键顺序插入数据，则插入之后最好需要OPTIMIZE TABLE重新组织表。
- 跟新聚类索引列是昂贵的额，因为它强制把每个更新的行移到新的位置
- 索引访问需要二次索引查找

#### 辅助索引
辅助索引又叫非聚集索引，叶子节点并不包含行记录的全部数据。叶子节点除了包含键值以外，每个叶子节点中的索引行还包含了一个书签，该书签用来告诉InnoDB存储索引哪里可以找到与索引相对应的行数据。

辅助索引的的书签就是存放聚类索引的键。 当通过辅助索引查询数据时，首先InnoDB存储引擎会遍历辅助索引并通过叶级别的指针获得指向主键索引的主键，然后通过主键索引来找到一个完整的行记录。

#### 覆盖索引
InnoDB支持覆盖索引，即从辅助索引中就可以得到查询的记录，而不需要再查询聚集索引的中的记录。使用覆盖索引的好处是辅助索引不包含整行记录的所有信息，故其大小远小于聚集索引，可以减少大量的IO操作。

叶子节点包含了他们索引的数据的指针，不需要再次读取行。

优势：

- 索引记录通常远小于全行大小，因此可以减少IO次数。
- 索引按索引值进行排序，它能让简单的范围查找使用完全的顺序索引访问。
- 叶子节点保存了主键的值，避免了索引的二次查找

### 局限
1. 如果查找没有冲索引列的最左边开始，它就没什么用处。 同样不能查找以特定字符结尾的人。

## 二. 哈希索引
底层采用hash算法，为了解决冲突，InnoDB采用了链式存储。它只对使用了索引中的每一列的精确查找有用，对于每一行，存储引擎计算出了被索引列的哈希码(Hash Code),和该行对应的行指针，而不是值自身。

Memory存储引擎支持显示的哈希索引。

缺点：

1. 内存存储，宕机后数据丢失
2. 内存存储，空间不足
3. 不支持排序
4. 不支持范围查找，效率低
4. 需要使用行指针继续读取行的内容
5. 不支持部分健匹配，因为它们是有被索引的全部值计算出来的。
6. 哈希索引支持=，In()和 <=> 的相等比较，它们不能加快范围查询。
7. 如果有很多碰撞，一个索引维护操作就有可能变慢

## 三. 全文索引
## 对比



参考：

 - [MySQL索引背后的数据结构及算法原理](http://blog.codinglabs.org/articles/theory-of-mysql-index.html)

